# Lab 01: Graviton(ARM) 인스턴스로 에너지 효율 체험하기

## 학습 목표

- AWS Graviton(ARM) 인스턴스와 x86 인스턴스의 차이를 이해합니다
- CDK를 사용하여 다양한 Graviton 인스턴스 패밀리(t4g, m7g, c7g)를 배포합니다
- ARM 아키텍처가 왜 에너지 효율적인지 설명할 수 있습니다
- x86 대비 최대 40% 에너지 절약의 원리를 이해합니다

## 사전 지식

- EC2 인스턴스 기본 개념 (인스턴스 타입, AMI)
- CDK 기본 문법 (Stack, Construct)
- 보안 그룹의 역할
- ARM vs x86 아키텍처의 기본 차이

## 아키텍처 다이어그램 (ASCII)

```
┌─────────────────────────────────────────────────────────────┐
│                        VPC (Default)                        │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                Security Group (SSH)                  │    │
│  │                                                     │    │
│  │  ┌──────────────┐  ┌──────────────┐                 │    │
│  │  │  t4g.micro   │  │  t3.micro    │  ← 비교 대상   │    │
│  │  │  (Graviton2) │  │  (x86)       │                 │    │
│  │  │  ARM 64-bit  │  │  x86 64-bit  │                 │    │
│  │  └──────────────┘  └──────────────┘                 │    │
│  │                                                     │    │
│  │  ┌──────────────┐  ┌──────────────┐                 │    │
│  │  │  m7g.medium  │  │  c7g.medium  │                 │    │
│  │  │  (Graviton3) │  │  (Graviton3) │                 │    │
│  │  │  범용        │  │  컴퓨팅최적화│                 │    │
│  │  └──────────────┘  └──────────────┘                 │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘

에너지 효율 비교:
  Graviton(ARM): ████████░░  ~60% 에너지로 동일 성능
  x86:           ██████████  100% 에너지 기준
```

## 선택적 배포 안내

> 이 Lab은 학습 목적으로 CDK 코드를 읽고 이해하는 것만으로도 충분합니다.
> 실제 배포를 원하는 경우 아래 안내를 따르세요.

### 배포 전 준비

```bash
# 1. 프로젝트 루트에서 의존성 설치
npm install

# 2. CDK Bootstrap (최초 1회)
npx cdk bootstrap

# 3. 변경 사항 미리보기
npx cdk diff --app "npx ts-node bin/app.ts"
```

### 배포

```bash
# 스택 배포
npx cdk deploy --app "npx ts-node bin/app.ts" SustainabilityGravitonStack
```

### 정리 (비용 방지)

```bash
# 스택 삭제 (모든 리소스 제거)
npx cdk destroy --app "npx ts-node bin/app.ts" SustainabilityGravitonStack
```

## 단계별 실습

### Step 1: 코드 읽기 - 인스턴스 타입 비교

`lib/graviton-stack.ts`를 열고 다음을 확인하세요:

1. **t4g.micro (Graviton2, ARM)**: 프리 티어 포함, 학습용으로 최적
2. **m7g.medium (Graviton3, ARM)**: 범용, 안정적 워크로드용
3. **c7g.medium (Graviton3, ARM)**: 컴퓨팅 최적화, CPU 집중 작업용
4. **t3.micro (x86)**: 비교 대상, 전통적 x86 아키텍처

**질문**: 왜 AMI가 두 종류(ARM_64, X86_64)로 나뉘어야 할까요?

### Step 2: Graviton 인스턴스 가격 비교

AWS 가격 페이지에서 같은 크기의 x86과 Graviton 인스턴스 가격을 비교해보세요:

| 인스턴스 | 아키텍처 | vCPU | 메모리 | 가격 (서울, 시간당) |
|---------|---------|------|--------|-------------------|
| t3.micro | x86 | 2 | 1 GiB | ~$0.013 |
| t4g.micro | ARM | 2 | 1 GiB | ~$0.011 |
| m5.large | x86 | 2 | 8 GiB | ~$0.118 |
| m7g.medium | ARM | 1 | 4 GiB | ~$0.050 |

**질문**: 가격이 약 20% 저렴하고, 에너지도 40% 절약한다면 왜 모든 회사가 전환하지 않을까요?

### Step 3: CloudWatch에서 비교하기 (배포 후)

배포 후 CloudWatch에서 다음 메트릭을 비교하세요:

1. `CPUUtilization` - 같은 작업 시 CPU 사용률 비교
2. `NetworkIn/NetworkOut` - 네트워크 처리량 비교
3. `CPUCreditBalance` - 버스트 인스턴스(t4g, t3)의 크레딧 소비 비교

### Step 4: 아키텍처 호환성 확인

```bash
# ARM 인스턴스에 접속 후 아키텍처 확인
uname -m
# 예상 출력: aarch64

# x86 인스턴스에 접속 후 아키텍처 확인
uname -m
# 예상 출력: x86_64
```

## 소크라테스 질문

1. **왜 AWS는 자체 프로세서(Graviton)를 설계했을까요?** Intel과 AMD 프로세서만으로는 부족했던 것은 무엇일까요?

2. **모든 워크로드가 Graviton으로 전환 가능할까요?** 어떤 워크로드가 x86에서만 동작해야 할까요?

3. **Graviton이 40% 에너지를 절약한다면, AWS의 총 에너지 소비에서 얼마나 큰 영향을 미칠까요?** AWS에서 실행되는 모든 EC2 인스턴스가 Graviton으로 전환된다면?

4. **t4g(버스트)와 m7g(범용)의 차이는 무엇일까요?** 웹 서버에는 어떤 것이 더 적합할까요?

5. **보안 그룹에서 SSH(22번 포트)를 anyIpv4()로 허용했습니다. 이것이 왜 위험할까요?** 더 나은 방법은 무엇일까요?

## 정리 및 다음 단계

### 이 Lab에서 배운 것
- Graviton 인스턴스는 ARM 아키텍처 기반으로 에너지 효율이 우수합니다
- t4g, m7g, c7g 등 용도별 Graviton 인스턴스 패밀리가 있습니다
- ARM과 x86은 다른 AMI가 필요합니다
- 가격과 에너지 효율 모두에서 Graviton이 유리합니다

### 다음 단계
- **Lab 02**: 서버리스 아키텍처로 유휴 리소스를 완전히 제거하는 방법을 배웁니다
- **노트**: `03-관리형-서비스.md`에서 Graviton과 서버리스의 관계를 더 깊이 이해합니다
