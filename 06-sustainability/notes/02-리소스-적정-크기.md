# 리소스 적정 크기와 지속 가능성

## 왜 이것이 중요한가? (질문)

> 읽기 전에 스스로에게 물어보세요: 유휴 서버는 얼마나 에너지를 낭비하는가? 서버가 아무 일도 하지 않아도 전기를 먹는다면, 그 비용은 누가 부담하는가?

## 핵심 개념

### 사용률 5% 서버의 에너지 낭비

**질문: 서버 CPU 사용률이 5%일 때, 에너지 소비는 최대 사용 시의 몇 %일까요? 5%일까요?**

놀라운 사실: 아이들(idle) 상태의 서버도 최대 부하 시 전력의 약 **60~70%**를 소비합니다.

```
전력 소비 비교:
┌─────────────────────────────────────────────────┐
│ CPU 사용률   │ 전력 소비 (최대 대비)              │
├─────────────────────────────────────────────────┤
│   0% (유휴)  │ ████████████████░░░░░░░░  ~60%    │
│   5%         │ █████████████████░░░░░░░  ~65%    │
│  50%         │ ████████████████████░░░░  ~80%    │
│ 100%         │ ████████████████████████  100%    │
└─────────────────────────────────────────────────┘
```

**핵심 통찰**: 5% 사용률 서버는 에너지의 약 95%를 "일"이 아닌 "존재"를 위해 소비합니다. 이것은 빈 버스를 운행하는 것과 같습니다.

**질문: 그렇다면 왜 기업들은 사용률이 낮은 서버를 그냥 두는 걸까요?**

- "만약에" 필요할까 봐 (과도한 프로비저닝)
- 누가 사용하는지 모르므로 함부로 끌 수 없음
- 성능 저하에 대한 두려움

### AWS Compute Optimizer

**질문: 내 EC2 인스턴스가 적정 크기인지 어떻게 알 수 있을까요?**

AWS Compute Optimizer는 CloudWatch 메트릭을 분석하여 리소스의 적정 크기를 추천합니다:

- **Over-provisioned (과도 프로비저닝)**: 더 작은 인스턴스로 변경 추천
- **Under-provisioned (부족 프로비저닝)**: 더 큰 인스턴스로 변경 추천
- **Optimized (최적화됨)**: 현재 크기가 적정

지원 리소스:
- EC2 인스턴스
- Auto Scaling 그룹
- EBS 볼륨
- Lambda 함수
- ECS 서비스 (Fargate)

**질문: Compute Optimizer가 "m5.xlarge를 m5.large로 줄이세요"라고 추천했습니다. 바로 적용해도 될까요?**

주의: Compute Optimizer는 과거 사용 패턴을 기반으로 추천합니다. 계절적 트래픽 변동이나 미래의 성장을 고려하지 않습니다. 데이터를 참고하되, 비즈니스 맥락을 함께 고려해야 합니다.

### Auto Scaling과 에너지 효율

**질문: 고정 서버 10대 vs Auto Scaling 2~10대. 같은 트래픽을 처리한다면 에너지 소비는 어떻게 다를까요?**

```
시간대별 트래픽과 서버 수:
                         고정 서버        Auto Scaling
새벽 2시 (트래픽 낮음)    10대 유지         2대
오전 9시 (트래픽 보통)    10대 유지         5대
오후 2시 (트래픽 높음)    10대 유지         9대
저녁 8시 (트래픽 보통)    10대 유지         5대

고정 서버 일일 총합: 10 × 24 = 240 인스턴스-시간
Auto Scaling 일일 총합: 약 120 인스턴스-시간 (예시)

→ Auto Scaling으로 약 50% 에너지 절약!
```

### 적정 크기 전략의 계층

에너지 효율을 위한 적정 크기 전략을 우선순위별로 정리합니다:

```
우선순위 높음
  │
  ▼
  1. 불필요한 리소스 제거 (사용하지 않는 EC2, EBS 등)
  2. 유휴 리소스 중지/종료 (개발 서버 야간 중지)
  3. 인스턴스 크기 최적화 (Compute Optimizer 추천 적용)
  4. 인스턴스 세대 업그레이드 (m5 → m7g, Graviton)
  5. Auto Scaling 적용
  6. 서버리스로 전환 (가능한 경우)
  │
  ▼
우선순위 낮음 (하지만 효과 큼)
```

**질문: 왜 서버리스 전환이 우선순위 목록 맨 아래에 있을까요? 가장 효율적이지 않나요?**

힌트: 효과는 크지만, 전환 비용과 복잡도도 가장 높습니다. 1~3번은 즉시 적용 가능하고, 4~6번은 아키텍처 변경이 필요합니다.

### Trusted Advisor의 지속 가능성 관련 검사

AWS Trusted Advisor는 다음과 같은 검사를 제공합니다:

- **Low Utilization Amazon EC2 Instances**: 사용률이 낮은 인스턴스 식별
- **Idle Load Balancers**: 트래픽이 없는 로드 밸런서
- **Unassociated Elastic IP Addresses**: 연결되지 않은 탄력적 IP
- **Underutilized Amazon EBS Volumes**: 활용도가 낮은 EBS 볼륨

**질문: Trusted Advisor와 Compute Optimizer의 차이는 무엇일까요?**

- Trusted Advisor: 넓은 범위의 체크리스트 (비용, 성능, 보안, 내결함성, 서비스 한도)
- Compute Optimizer: 머신러닝 기반의 세밀한 리소스 크기 추천

## 잠깐, 그런데... (흔한 오해)

### 오해 1: "항상 가장 작은 인스턴스를 선택하면 친환경이다"
너무 작은 인스턴스는 CPU를 항상 100%로 사용하여 오히려 비효율적입니다. 또한 작업 완료 시간이 길어져 총 에너지 소비가 증가할 수 있습니다. **적정(Right-sizing)**이 핵심입니다.

### 오해 2: "Auto Scaling은 비용을 위한 것이지 환경을 위한 것이 아니다"
Auto Scaling은 수요에 맞춰 리소스를 조절합니다. 줄어든 리소스 = 줄어든 에너지 소비 = 줄어든 탄소 배출. 비용 절감과 환경 보호가 함께 달성됩니다.

### 오해 3: "서버를 끄면 데이터를 잃는다"
EC2를 중지(Stop)하면 EBS 데이터는 유지됩니다. 종료(Terminate)와 중지(Stop)는 다릅니다. 개발 서버를 야간/주말에 중지하는 것만으로도 큰 에너지 절약이 가능합니다.

## 핸즈온 연결

- **Lab 01**: Graviton 인스턴스 배포로 같은 성능 대비 에너지 절약 확인
- **Compute Optimizer**: 기존 인스턴스의 적정 크기 추천 확인 (콘솔에서 직접 확인)

## SAA 시험 핵심 포인트

1. **Compute Optimizer**는 CloudWatch 메트릭을 분석하여 EC2, EBS, Lambda, ECS의 적정 크기를 추천합니다
2. **Trusted Advisor**는 사용률이 낮은 EC2 인스턴스를 식별합니다 (Business/Enterprise Support 필요)
3. **Auto Scaling**은 비용 최적화와 지속 가능성 모두에 기여합니다
4. 유휴 서버도 최대 부하의 60~70% 전력을 소비합니다
5. **EC2 Instance Scheduler**로 개발/테스트 환경의 자동 시작/중지 스케줄 관리 가능
6. **적정 크기(Right-sizing)**는 과도 프로비저닝과 부족 프로비저닝 모두를 피하는 것입니다

## 관련 Pillar

- **비용 최적화 (Cost Optimization)**: 적정 크기 조정은 비용 절감의 핵심 전략
- **성능 효율성 (Performance Efficiency)**: 적정 크기는 성능 요구사항을 충족하면서 효율성을 극대화
- **지속 가능성 (Sustainability)**: 리소스 최적화는 에너지 낭비 최소화의 핵심
