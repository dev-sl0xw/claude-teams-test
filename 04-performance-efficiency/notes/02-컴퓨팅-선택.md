# 컴퓨팅 선택: EC2 vs Lambda vs ECS vs Fargate

## 왜 이것이 중요한가? (질문)

> 읽기 전에 스스로에게 물어보세요: 당신의 애플리케이션이 하루에 100번 호출된다면 EC2를 24시간 켜놓겠습니까? 반대로, 초당 10만 건을 처리해야 한다면 Lambda로 충분할까요? "어떤 컴퓨팅을 선택하느냐"가 비용과 성능을 결정합니다.

## 핵심 개념

### 왜 컴퓨팅 선택이 가장 중요한 결정인가?

컴퓨팅은 모든 애플리케이션의 "엔진"입니다. 잘못된 엔진을 선택하면 아무리 다른 부분을 최적화해도 한계가 있습니다. AWS는 다양한 컴퓨팅 옵션을 제공하며, 각각의 **트레이드오프**를 이해해야 합니다.

### EC2 (Elastic Compute Cloud)

**무엇인가?** 가상 서버. 운영체제부터 애플리케이션까지 모든 것을 직접 관리합니다.

**왜 여전히 EC2를 사용하는가?**
- 완전한 제어가 필요한 경우 (커널 튜닝, GPU, 특수 하드웨어)
- 예측 가능한 일정 트래픽
- 레거시 애플리케이션 마이그레이션 (리프트 앤 시프트)
- 라이선스 제약 (BYOL - Bring Your Own License)

| 인스턴스 패밀리 | 용도 | 예시 |
|-----------------|------|------|
| **t3/t4g** (버스터블) | 간헐적 워크로드, 개발 환경 | 소규모 웹서버, 개발 서버 |
| **m5/m6g** (범용) | 균형 잡힌 컴퓨팅/메모리 | 일반 웹 애플리케이션, 중규모 DB |
| **c5/c6g** (컴퓨팅 최적화) | CPU 집약적 작업 | 배치 처리, 게임 서버, HPC |
| **r5/r6g** (메모리 최적화) | 대용량 인메모리 처리 | 인메모리 DB, 실시간 분석 |
| **p4/g5** (가속 컴퓨팅) | GPU 작업 | ML 학습, 비디오 인코딩 |

> 질문: "g" 접미사가 붙은 인스턴스(m6g, c6g)는 무엇이 다른가요? Graviton 프로세서의 장점은?

### Lambda

**무엇인가?** 이벤트 기반 서버리스 컴퓨팅. 코드만 업로드하면 AWS가 나머지를 관리합니다.

**왜 Lambda를 선택하는가?**
- 인프라 관리 부담 제거 (패치, 스케일링, 모니터링 자동화)
- 사용한 만큼만 비용 지불 (실행 시간 밀리초 단위 과금)
- 자동으로 수천 개의 동시 실행으로 확장

**Lambda의 핵심 제약사항 (SAA 시험 빈출)**

| 제약 | 값 | 왜 이 제약이 존재하는가? |
|------|-----|-------------------------|
| 최대 실행 시간 | 15분 | 장시간 작업은 Step Functions로 분할 |
| 메모리 | 128MB ~ 10,240MB | 메모리에 비례하여 CPU도 할당됨 |
| 배포 패키지 크기 | 50MB (zip), 250MB (압축 해제) | 콘테이너 이미지는 10GB까지 가능 |
| 동시 실행 | 기본 1,000 (리전당) | Service Quotas에서 증가 요청 가능 |
| 임시 스토리지 (/tmp) | 512MB ~ 10,240MB | 영구 저장은 S3/EFS 사용 |

**콜드 스타트 문제**

> 질문: Lambda 함수를 처음 호출할 때 왜 응답이 느린가요?

콜드 스타트는 Lambda가 새로운 실행 환경을 초기화하는 과정입니다:
1. 실행 환경 생성 (컨테이너 프로비저닝)
2. 코드 다운로드 (S3에서 배포 패키지 로드)
3. 런타임 초기화 (Python/Node.js 인터프리터 시작)
4. 핸들러 외부 코드 실행 (DB 연결 설정 등)

**콜드 스타트 완화 전략:**
- Provisioned Concurrency: 미리 실행 환경을 준비 (비용 발생)
- 패키지 크기 최소화
- 런타임 선택: Python/Node.js > Java (JVM 초기화 오래 걸림)
- VPC 연결 최소화 (ENI 생성에 시간 소요, 최근에는 개선됨)

### ECS (Elastic Container Service)

**무엇인가?** Docker 컨테이너를 실행하고 관리하는 오케스트레이션 서비스.

**왜 컨테이너를 사용하는가?**
- "내 컴퓨터에서는 되는데..." 문제 해결 (환경 일관성)
- 마이크로서비스 아키텍처에 적합
- 빠른 배포와 롤백
- 리소스 격리 (각 컨테이너가 독립적 환경)

**ECS 실행 모드 비교**

| 구분 | ECS on EC2 | ECS on Fargate |
|------|------------|----------------|
| 인프라 관리 | 직접 (EC2 관리 필요) | AWS가 관리 |
| 비용 | EC2 인스턴스 비용 | vCPU + 메모리 단위 과금 |
| GPU 지원 | 가능 | 불가 |
| 유연성 | 높음 (인스턴스 유형 선택) | 제한적 |
| 확장 속도 | 느림 (EC2 부팅 필요) | 빠름 |

### Fargate

**무엇인가?** 서버리스 컨테이너 엔진. EC2 인스턴스를 관리하지 않고 컨테이너를 실행합니다.

**왜 Fargate를 선택하는가?**
- 컨테이너가 필요하지만 EC2를 관리하고 싶지 않을 때
- Lambda의 15분 제한이 너무 짧을 때
- 장시간 실행되는 작업 (배치 처리, 데이터 파이프라인)

> 질문: Lambda와 Fargate 모두 "서버리스"인데, 언제 어떤 것을 선택해야 하나요?

### 워크로드별 최적 선택 가이드

```
워크로드 분석 의사결정 트리:

[시작] 실행 시간이 15분 이내인가?
  ├─ YES → 이벤트 기반인가?
  │         ├─ YES → ★ Lambda
  │         └─ NO → 동시 실행이 많은가?
  │                   ├─ YES → ★ Lambda (동시 실행 활용)
  │                   └─ NO → ★ Lambda 또는 Fargate
  └─ NO → 컨테이너 사용이 가능한가?
           ├─ YES → GPU가 필요한가?
           │         ├─ YES → ★ ECS on EC2 (GPU 인스턴스)
           │         └─ NO → 인프라 관리를 원하는가?
           │                   ├─ YES → ★ ECS on EC2
           │                   └─ NO → ★ Fargate
           └─ NO → 특수 하드웨어/OS가 필요한가?
                     ├─ YES → ★ EC2
                     └─ NO → ★ EC2 또는 컨테이너 전환 고려
```

### 실제 시나리오 비교

| 시나리오 | 최적 선택 | 이유 |
|----------|-----------|------|
| REST API (변동 트래픽) | Lambda + API Gateway | 트래픽 없으면 비용 0, 자동 확장 |
| 웹 애플리케이션 (안정 트래픽) | ECS/Fargate + ALB | 예측 가능한 비용, 장시간 실행 |
| 배치 데이터 처리 (야간) | Fargate (또는 Spot EC2) | 시작/종료가 명확, 관리 부담 최소 |
| ML 모델 학습 | EC2 (p4/g5 인스턴스) | GPU 필요, 장시간 실행 |
| 이미지 리사이징 | Lambda | 이벤트 기반(S3 트리거), 짧은 실행 |
| 실시간 채팅 서버 | ECS on EC2 | WebSocket 장시간 연결, 상태 유지 |

## 잠깐, 그런데... (흔한 오해)

### 오해 1: "Lambda가 항상 가장 저렴하다"
Lambda는 실행 시간 기반 과금이므로, **지속적으로 높은 트래픽**을 처리하는 워크로드에서는 EC2가 더 경제적입니다. 하루 24시간 꾸준히 실행되는 워크로드는 EC2 Reserved Instance를 고려하세요.

### 오해 2: "ECS와 EKS는 같은 것이다"
ECS는 AWS 네이티브 오케스트레이션, EKS는 Kubernetes 기반입니다. 이미 Kubernetes 경험이 있거나 멀티 클라우드 전략이라면 EKS, 그렇지 않으면 ECS가 더 간단합니다.

### 오해 3: "Fargate는 항상 ECS on EC2보다 비싸다"
단순 비교로는 Fargate가 비싸 보이지만, EC2의 **관리 비용(패치, 모니터링, 스케일링)**을 포함하면 Fargate가 더 경제적일 수 있습니다.

## 핸즈온 연결

> 이 개념은 [Lab 01 - Lambda Functions]에서 구현됩니다.
>
> Lambda 함수를 CDK로 배포하고, API Gateway와 연동하여 콜드 스타트를 직접 측정합니다.
> Python 런타임의 콜드/웜 스타트 차이를 체감할 수 있습니다.

## SAA 시험 핵심 포인트

- Lambda 제약사항: 15분 실행 시간, 10GB 메모리, 동시 실행 한도
- Lambda 콜드 스타트 완화: Provisioned Concurrency, 패키지 최소화, 적절한 런타임 선택
- EC2 인스턴스 패밀리 선택: 워크로드 특성(CPU/메모리/GPU)에 맞는 패밀리 선택
- Fargate vs ECS on EC2: GPU가 필요하면 EC2, 관리 부담을 줄이려면 Fargate
- Lambda@Edge vs CloudFront Functions: 엣지에서 실행, 각각의 제약사항 차이
- Graviton(ARM) 인스턴스: x86 대비 최대 40% 가격 대비 성능 향상

## 관련 Pillar

- **비용 최적화**: 컴퓨팅 선택이 비용에 가장 큰 영향을 미침 (Spot, RI, Savings Plans)
- **안정성**: Auto Scaling과 Multi-AZ 배포로 가용성 확보
- **보안**: Lambda 실행 역할(Execution Role)의 최소 권한 원칙
- **운영 우수성**: CloudWatch로 Lambda 동시 실행, 에러율, 실행 시간 모니터링
