# 스토리지 최적화: EBS vs S3 vs EFS vs FSx

## 왜 이것이 중요한가? (질문)

> 읽기 전에 스스로에게 물어보세요: 데이터베이스에 gp2 볼륨을 사용하고 있는데 IOPS가 부족하다면, 볼륨 크기를 늘려야 할까요, 아니면 볼륨 유형을 바꿔야 할까요? "스토리지 유형 선택"이 성능과 비용 모두에 결정적 영향을 미칩니다.

## 핵심 개념

### 왜 스토리지 선택이 중요한가?

데이터는 애플리케이션의 "연료"입니다. 연료 탱크(스토리지)가 엔진(컴퓨팅)의 속도를 따라가지 못하면, 아무리 강력한 엔진이라도 소용없습니다. AWS는 다양한 스토리지 옵션을 제공하며, 각각 **IOPS, 처리량, 지연시간** 특성이 다릅니다.

### 스토리지 성능의 3가지 축

| 메트릭 | 정의 | 비유 |
|--------|------|------|
| **IOPS** | 초당 I/O 작업 수 | 고속도로의 톨게이트 수 |
| **처리량 (Throughput)** | 초당 전송 데이터 양 (MB/s) | 고속도로의 차선 폭 |
| **지연시간 (Latency)** | I/O 작업 완료까지의 시간 (ms) | 출발지에서 목적지까지의 거리 |

> 질문: 데이터베이스와 비디오 스트리밍, 어떤 것이 IOPS가 더 중요하고 어떤 것이 처리량이 더 중요할까요?

### EBS (Elastic Block Store) - 블록 스토리지

**무엇인가?** EC2 인스턴스에 연결되는 네트워크 기반 블록 스토리지. 하드디스크/SSD 역할.

**왜 EBS가 필요한가?**
- EC2 인스턴스의 기본 스토리지는 "인스턴스 스토어"로, 인스턴스 중지 시 데이터가 사라집니다
- EBS는 인스턴스와 독립적으로 데이터가 영구 보존됩니다
- 스냅샷으로 백업 및 복원이 가능합니다

**EBS 볼륨 유형 비교 (SAA 시험 핵심)**

| 유형 | 사용 사례 | 최대 IOPS | 최대 처리량 | 지연시간 |
|------|-----------|-----------|-------------|----------|
| **gp3** (범용 SSD) | 대부분의 워크로드 | 16,000 | 1,000 MB/s | 1자리 ms |
| **gp2** (범용 SSD, 이전 세대) | 레거시 | 16,000 (크기 비례) | 250 MB/s | 1자리 ms |
| **io2 Block Express** (프로비저닝 IOPS SSD) | 고성능 DB | 256,000 | 4,000 MB/s | sub-ms |
| **st1** (처리량 최적화 HDD) | 빅데이터, 로그 | 500 | 500 MB/s | 수 ms |
| **sc1** (콜드 HDD) | 아카이빙 | 250 | 250 MB/s | 수 ms |

> 질문: gp2에서 gp3로 왜 전환해야 하나요? gp2는 "볼륨 크기에 비례한 IOPS"라는 점이 핵심입니다. 1TB gp2는 3,000 IOPS이지만, gp3는 크기와 무관하게 3,000 IOPS가 기본입니다.

**gp2 vs gp3 심층 비교**

```
gp2: IOPS = 볼륨 크기(GB) x 3 (최소 100, 최대 16,000)
  → 5,000 IOPS가 필요하면? 최소 1,667GB 볼륨 필요 (비용 낭비!)

gp3: IOPS = 기본 3,000 + 추가 구매 가능 (최대 16,000)
  → 5,000 IOPS가 필요하면? 어떤 크기든 추가 2,000 IOPS만 구매
```

### S3 (Simple Storage Service) - 오브젝트 스토리지

**무엇인가?** 무한 확장 가능한 오브젝트 스토리지. 파일을 키-값 형태로 저장합니다.

**왜 S3를 블록 스토리지 대신 사용하는가?**
- 무한 확장: 용량 제한 없음
- 11 9's (99.999999999%) 내구성
- 다양한 스토리지 클래스로 비용 최적화
- 정적 웹 호스팅, CDN 오리진으로 활용 가능

**S3 성능 특성**

| 메트릭 | 값 |
|--------|-----|
| PUT/COPY/POST/DELETE | 프리픽스당 3,500 요청/초 |
| GET/HEAD | 프리픽스당 5,500 요청/초 |
| S3 Transfer Acceleration | 장거리 전송 속도 50~500% 향상 |
| Multipart Upload | 5GB 이상 필수, 100MB 이상 권장 |

> 질문: "프리픽스당" 성능 제한이라는 것은 무엇을 의미할까요? 키 설계가 성능에 미치는 영향을 생각해보세요.

### EFS (Elastic File System) - 공유 파일 스토리지

**무엇인가?** 여러 EC2/Lambda에서 동시에 접근 가능한 NFS 기반 파일 시스템.

**왜 EFS가 필요한가?**
- EBS는 하나의 EC2에만 연결 (Multi-Attach는 io2만 가능, 제약 많음)
- 여러 인스턴스가 동일 파일에 접근해야 할 때 (공유 스토리지)
- Lambda의 영구 스토리지로 사용 가능

**EFS 성능 모드 비교**

| 모드 | 지연시간 | 처리량 | 사용 사례 |
|------|----------|--------|-----------|
| **범용 (General Purpose)** | 수 ms | 자동 확장 | 웹 서비스, CMS, 홈 디렉토리 |
| **최대 I/O** | 수십 ms | 매우 높음 | 빅데이터, 미디어 처리 |

**EFS 처리량 모드**

| 모드 | 설명 |
|------|------|
| **버스팅** | 파일 시스템 크기에 비례한 처리량 (크레딧 기반) |
| **프로비저닝** | 고정 처리량 지정 (크기와 무관) |
| **탄력적** | 워크로드에 맞춰 자동 확장 (권장) |

### FSx - 고성능 파일 시스템

**왜 EFS 대신 FSx를 사용하는가?**

| FSx 유형 | 프로토콜 | 사용 사례 |
|----------|----------|-----------|
| **FSx for Lustre** | Lustre | HPC, ML 학습, 비디오 렌더링 |
| **FSx for Windows** | SMB | Windows 워크로드, Active Directory 통합 |
| **FSx for NetApp ONTAP** | NFS/SMB/iSCSI | 엔터프라이즈, 멀티 프로토콜 |
| **FSx for OpenZFS** | NFS | Linux 워크로드, 스냅샷 활용 |

> 질문: ML 학습에서 S3의 데이터를 직접 읽는 것과, FSx for Lustre를 통해 읽는 것의 성능 차이는 왜 발생할까요?

### 스토리지 선택 의사결정

```
[시작] 여러 인스턴스에서 동시 접근이 필요한가?
  ├─ NO → 블록 레벨 접근이 필요한가? (OS, DB)
  │        ├─ YES → IOPS가 16,000 이상 필요한가?
  │        │         ├─ YES → ★ io2 Block Express
  │        │         └─ NO → ★ gp3
  │        └─ NO → ★ S3
  └─ YES → NFS 프로토콜인가?
            ├─ YES → 초고성능(HPC)이 필요한가?
            │         ├─ YES → ★ FSx for Lustre
            │         └─ NO → ★ EFS
            └─ NO → SMB 프로토콜인가?
                      ├─ YES → ★ FSx for Windows
                      └─ NO → ★ S3 (API 기반 접근)
```

## 잠깐, 그런데... (흔한 오해)

### 오해 1: "S3는 느리다"
S3는 오브젝트 스토리지라 파일 시스템 연산(random read/write)에는 적합하지 않지만, **대용량 파일 전송**(Multipart Upload, Transfer Acceleration)에서는 매우 빠릅니다.

### 오해 2: "EBS gp2에서 IOPS를 높이려면 볼륨 크기를 늘려야 한다"
gp3로 전환하면 볼륨 크기와 무관하게 IOPS를 독립적으로 조절할 수 있습니다. **gp2에서 gp3로의 무중단 전환이 가능**합니다.

### 오해 3: "EFS는 비싸서 사용하지 말아야 한다"
EFS Infrequent Access(IA) 스토리지 클래스를 활용하면 자주 접근하지 않는 파일의 비용을 최대 92% 절감할 수 있습니다.

### 오해 4: "인스턴스 스토어는 사용하면 안 된다"
인스턴스 스토어는 EBS보다 **IOPS가 훨씬 높습니다** (수십만 IOPS). 캐시, 임시 데이터처럼 손실되어도 괜찮은 데이터에는 최적의 성능을 제공합니다.

## 핸즈온 연결

> 이 개념은 [Lab 03 - CloudFront CDN]에서 S3를 오리진으로 활용하며, [Lab 01 - S3 Lifecycle (05-비용최적화)]에서 S3 스토리지 클래스 전환을 실습합니다.
>
> S3 버킷을 CDK로 구성하고, CloudFront와 연동하여 정적 콘텐츠 배포 시 S3의 성능 특성을 체감합니다.

## SAA 시험 핵심 포인트

- EBS gp3 vs gp2: gp3는 IOPS/처리량을 독립적으로 설정, gp2는 크기에 비례
- io2 Block Express: 최대 256,000 IOPS, sub-millisecond 지연시간, 미션 크리티컬 DB
- S3 성능: 프리픽스당 3,500 PUT + 5,500 GET/초, Multipart Upload로 대용량 최적화
- EFS vs EBS: EFS는 다중 인스턴스 공유, EBS는 단일 인스턴스 (io2 Multi-Attach 제외)
- FSx for Lustre: HPC/ML 워크로드, S3와 자동 연동 가능
- FSx for Windows: SMB 프로토콜, Active Directory 통합
- 인스턴스 스토어: 임시 데이터에 최고 성능, 인스턴스 중지 시 데이터 손실
- S3 Transfer Acceleration: 글로벌 사용자의 업로드 속도 향상, CloudFront 엣지 로케이션 활용

## 관련 Pillar

- **비용 최적화**: 스토리지 클래스 선택이 비용에 직접적 영향 (gp2->gp3 전환, S3 IA/Glacier)
- **안정성**: EBS 스냅샷, S3 Cross-Region Replication으로 데이터 보호
- **보안**: S3 버킷 정책, EBS 암호화, EFS 전송 중 암호화
- **운영 우수성**: CloudWatch로 EBS IOPS, S3 요청 수 모니터링
